<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diaspora Romana Tournament</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        .dark { background-color: #1a1a1a; color: #e5e5e5; }
        .dark .bg-white { background-color: #2a2a2a; }
        .dark .bg-gray-50 { background-color: #1f1f1f; }
        .dark .bg-gray-100 { background-color: #2a2a2a; }
        .dark .text-gray-900 { color: #e5e5e5; }
        .dark .text-gray-700 { color: #d1d1d1; }
        .dark .text-gray-600 { color: #b3b3b3; }
        .dark .border-gray-200 { border-color: #404040; }
        .dark .border-gray-300 { border-color: #404040; }
        .dark .hover\:bg-gray-100:hover { background-color: #3a3a3a; }
        .dark .bg-blue-600 { background-color: #2563eb; }
        .dark input, .dark select { background-color: #2a2a2a; color: #e5e5e5; border-color: #404040; }
        .toast { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .list-item { padding: 8px 12px; }
        .position-badge { min-width: 28px; }
        .column-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        @media (max-width: 1024px) {
            .column-container { grid-template-columns: 1fr; }
        }
        .full-width { width: 100%; max-width: 100%; padding-left: 1rem; padding-right: 1rem; }
        @media (min-width: 640px) {
            .full-width { padding-left: 1.5rem; padding-right: 1.5rem; }
        }
        @media (min-width: 1024px) {
            .full-width { padding-left: 2rem; padding-right: 2rem; }
        }
        .lang-dropdown { position: relative; }
        .lang-dropdown-menu { position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 50; }
        .dark .lang-dropdown-menu { background: #2a2a2a; border-color: #404040; }
        .single-list-view { display: none; }
        .single-list-view.active { display: block; }
        .three-column-view { display: grid; }
        .three-column-view.hidden { display: none; }
        .unavailable-member { background-color: #fef2f2 !important; border-color: #fca5a5 !important; }
        .dark .unavailable-member { background-color: #7f1d1d !important; border-color: #dc2626 !important; }
        .preselected { background-color: #dbeafe !important; border-color: #3b82f6 !important; }
        .dark .preselected { background-color: #1e3a8a !important; border-color: #60a5fa !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen transition-colors duration-300">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="full-width">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900" data-lang="title">Diaspora Romana Tournament</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="lang-dropdown">
                        <button onclick="toggleLangDropdown()" class="p-2 rounded-lg hover:bg-gray-100 transition flex items-center space-x-2">
                            <span id="currentLang">ğŸ‡·ğŸ‡´ RO</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="langDropdownMenu" class="hidden lang-dropdown-menu mt-2">
                            <button onclick="changeLanguage('ro')" class="block w-full text-left px-4 py-2 hover:bg-gray-100 transition">
                                ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ
                            </button>
                            <button onclick="changeLanguage('en')" class="block w-full text-left px-4 py-2 hover:bg-gray-100 transition">
                                ğŸ‡¬ğŸ‡§ English
                            </button>
                        </div>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-lg hover:bg-gray-100 transition">
                        <span id="darkModeIcon">ğŸŒ™</span>
                    </button>
                    <div id="userSection" class="flex items-center space-x-3">
                        <span id="userInfo" class="text-gray-600"></span>
                        <button id="loginBtn" onclick="showLogin()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" data-lang="adminLogin">
                            Admin Login
                        </button>
                        <button id="logoutBtn" onclick="logout()" class="hidden px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" data-lang="logout">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="full-width py-8">
        <!-- Status Messages -->
        <div id="statusMessages" class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
            <div class="flex items-center">
                <span class="text-blue-700 font-medium">â„¹ï¸</span>
                <span id="statusText" class="ml-2 text-blue-700"></span>
            </div>
        </div>

        <!-- Dashboard Cards - 4 Columns -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
            <div onclick="showSingleList('all')" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-200 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm" data-lang="totalMembers">Membri Total</p>
                        <p id="totalMembers" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <span class="text-2xl">ğŸ‘¥</span>
                    </div>
                </div>
            </div>
            
            <div onclick="showSingleList('main')" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-200 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm" data-lang="mainList">ListÄƒ PrincipalÄƒ</p>
                        <p id="mainListCount" class="text-3xl font-bold text-green-600 mt-2">32</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg">
                        <span class="text-2xl">ğŸ†</span>
                    </div>
                </div>
            </div>
            
            <div onclick="showSingleList('reserve')" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-200 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm" data-lang="reserveList">ListÄƒ Rezerve</p>
                        <p id="reserveListCount" class="text-3xl font-bold text-yellow-600 mt-2">0</p>
                    </div>
                    <div class="bg-yellow-100 p-3 rounded-lg">
                        <span class="text-2xl">â³</span>
                    </div>
                </div>
            </div>
            
            <div onclick="showSingleList('unavailable')" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-200 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm" data-lang="unavailableList">Indisponibili</p>
                        <p id="unavailableCount" class="text-3xl font-bold text-red-600 mt-2">0</p>
                    </div>
                    <div class="bg-red-100 p-3 rounded-lg">
                        <span class="text-2xl">ğŸš«</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Controls -->
        <div id="adminControls" class="hidden mb-8 fade-in">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4" data-lang="adminPanel">Panou Administrare</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button onclick="generateDailyList()" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                        <span class="mr-2">ğŸ”„</span> <span data-lang="generateList">GenereazÄƒ Lista</span>
                    </button>
                    <button onclick="showUnlockModal()" class="px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition flex items-center justify-center">
                        <span class="mr-2">ğŸ”“</span> <span data-lang="unlockList">DeblocheazÄƒ Lista</span>
                    </button>
                    <button onclick="showAddMemberModal()" class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center">
                        <span class="mr-2">â•</span> <span data-lang="addMember">AdaugÄƒ Membru</span>
                    </button>
                    <button onclick="showBulkUploadModal()" class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center justify-center">
                        <span class="mr-2">ğŸ“¤</span> <span data-lang="bulkUpload">ÃncÄƒrcare Bulk</span>
                    </button>
                    <button onclick="showAuditLog()" class="px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center justify-center">
                        <span class="mr-2">ğŸ“‹</span> <span data-lang="auditLog">Audit Log</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Three Column Lists Display -->
        <div id="threeColumnView" class="three-column-view bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-900" data-lang="memberLists">Liste Membri</h2>
                <div class="flex space-x-3">
                    <button onclick="exportToPDF()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        ğŸ“„ PDF
                    </button>
                    <button onclick="exportToExcel()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        ğŸ“Š Excel
                    </button>
                    <button onclick="showHistory()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        ğŸ“… <span data-lang="history">Istoric</span>
                    </button>
                </div>
            </div>
            
            <div class="column-container">
                <!-- Main List Column -->
                <div id="mainList" class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-semibold text-green-700 mb-3 flex items-center">
                        <span class="mr-2">ğŸ†</span> <span data-lang="mainListTitle">ListÄƒ PrincipalÄƒ</span> (32 <span data-lang="players">jucÄƒtori</span>)
                    </h3>
                    <div id="mainListContent" class="space-y-2">
                        <!-- Main list items will be inserted here -->
                    </div>
                </div>
                
                <!-- Reserve List Column -->
                <div id="reserveList" class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-700 mb-3 flex items-center">
                        <span class="mr-2">â³</span> <span data-lang="reserveListTitle">ListÄƒ Rezerve</span>
                    </h3>
                    <div id="reserveListContent" class="space-y-2">
                        <!-- Reserve list items will be inserted here -->
                    </div>
                </div>
                
                <!-- Unavailable List Column -->
                <div id="unavailableList" class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-semibold text-red-700 mb-3 flex items-center">
                        <span class="mr-2">ğŸš«</span> <span data-lang="unavailableListTitle">Indisponibili</span>
                    </h3>
                    <div id="unavailableListContent" class="space-y-2">
                        <!-- Unavailable list items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Single List View -->
        <div id="singleListView" class="single-list-view bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="singleListTitle" class="text-xl font-semibold text-gray-900"></h2>
                <div class="flex space-x-3">
                    <button onclick="backToThreeColumns()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        â† <span data-lang="backToAll">Ãnapoi la toate listele</span>
                    </button>
                    <button onclick="exportToPDF()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        ğŸ“„ PDF
                    </button>
                    <button onclick="exportToExcel()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        ğŸ“Š Excel
                    </button>
                    <button onclick="showHistory()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        ğŸ“… <span data-lang="history">Istoric</span>
                    </button>
                </div>
            </div>
            <div id="singleListContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Single list items will be inserted here -->
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="adminLoginTitle">Autentificare Administrator</h3>
            <input type="password" id="adminPassword" placeholder="IntroduceÈ›i parola" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4">
            <div class="flex space-x-3">
                <button onclick="login()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" data-lang="login">Login</button>
                <button onclick="closeModal('loginModal')" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- Unlock Modal -->
    <div id="unlockModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="unlockTitle">DeblocheazÄƒ Lista ZilnicÄƒ</h3>
            <p class="text-gray-600 mb-4" data-lang="unlockDesc">IntroduceÈ›i parola pentru a debloca lista È™i a o regenera:</p>
            <input type="password" id="unlockPassword" placeholder="ParolÄƒ deblocare" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-6">
            <div class="flex space-x-3">
                <button onclick="unlockDailyList()" class="flex-1 px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition" data-lang="unlock">DeblocheazÄƒ</button>
                <button onclick="closeModal('unlockModal')" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="addMemberTitle">AdaugÄƒ Membru Nou</h3>
            <input type="text" id="newMemberName" placeholder="Nume membru" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="unavailableDate">Data indisponibilitÄƒÈ›ii (ZZ-LL-AAAA)</label>
            <input type="text" id="newMemberUnavailableDate" placeholder="ex: 25-12-2024" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-6">
            <div class="flex space-x-3">
                <button onclick="addMember()" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition" data-lang="add">AdaugÄƒ</button>
                <button onclick="closeModal('addMemberModal')" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="bulkUploadTitle">ÃncÄƒrcare Bulk</h3>
            <p class="text-sm text-red-600 mb-4" data-lang="bulkWarning">âš ï¸ AtenÈ›ie: AceastÄƒ acÈ›iune va È™terge toÈ›i membrii existenÈ›i!</p>
            <input type="password" id="bulkPassword" placeholder="ParolÄƒ Ã®ncÄƒrcare" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4">
            <textarea id="bulkData" placeholder="IntroduceÈ›i numele (unul pe linie)" 
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-6 h-32"></textarea>
            <div class="flex space-x-3">
                <button onclick="processBulkUpload()" class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" data-lang="upload">ÃncarcÄƒ</button>
                <button onclick="closeModal('bulkUploadModal')" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- Generate List Modal -->
    <div id="generateListModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 fade-in max-h-[80vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="selectPlayers">SelectaÈ›i 5 jucÄƒtori pentru Ã®nlocuire</h3>
            <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-sm text-yellow-800">
                    <span class="font-semibold" data-lang="autoSelected">SelecÈ›ie automatÄƒ:</span> 
                    <span data-lang="autoSelectedDesc">JucÄƒtorii indisponibili din lista principalÄƒ sunt preselecÈ›aÈ›i (roÈ™u). AceÈ™tia vor fi Ã®nlocuiÈ›i automat.</span>
                </p>
            </div>
            <div id="currentListForReplace" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                <!-- Current list items will be inserted here -->
            </div>
            <div class="flex justify-between items-center">
                <p class="text-gray-600" data-lang="selectedCount">SelectaÈ›i: <span id="selectedCount" class="font-bold text-blue-600">0</span>/5</p>
                <div class="flex space-x-3">
                    <button onclick="showConfirmationModal()" id="continueBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed" disabled data-lang="continue">ContinuÄƒ</button>
                    <button onclick="closeModal('generateListModal')" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="confirmReplace">Confirmare Ãnlocuire</h3>
            <div class="space-y-4 mb-6">
                <div class="bg-red-50 p-4 rounded-lg">
                    <p class="font-semibold text-red-700 mb-2" data-lang="playersToReplace">JucÄƒtori care vor fi Ã®nlocuiÈ›i:</p>
                    <div id="playersToReplace" class="text-sm text-red-600"></div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <p class="font-semibold text-green-700 mb-2" data-lang="playersToEnter">JucÄƒtori care vor intra Ã®n listÄƒ:</p>
                    <div id="playersToPromote" class="text-sm text-green-600"></div>
                </div>
            </div>
            <div class="flex space-x-3">
                <button onclick="confirmGenerateList()" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" data-lang="confirmReplaceBtn">ConfirmÄƒ Ãnlocuirea</button>
                <button onclick="backToSelection()" class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="backToSelection">Revino la SelecÈ›ie</button>
                <button onclick="closeModal('confirmationModal')" class="flex-1 px-6 py-3 bg-red-200 text-red-700 rounded-lg hover:bg-red-300 transition" data-lang="cancelAll">AnuleazÄƒ Tot</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 fade-in max-h-[80vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="historyTitle">Istoric Listelor Zilnice</h3>
            <div id="historyContent" class="space-y-4">
                <!-- History items will be inserted here -->
            </div>
            <button onclick="closeModal('historyModal')" class="mt-6 w-full px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="close">Ãnchide</button>
        </div>
    </div>

    <!-- Audit Log Modal -->
    <div id="auditLogModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 fade-in max-h-[80vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="auditLogTitle">Audit Log</h3>
            <div id="auditLogContent" class="space-y-2">
                <!-- Audit log items will be inserted here -->
            </div>
            <button onclick="closeModal('auditLogModal')" class="mt-6 w-full px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="close">Ãnchide</button>
        </div>
    </div>

    <!-- Set Unavailable Modal -->
    <div id="setUnavailableModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-6" data-lang="setUnavailableTitle">Setare Indisponibilitate</h3>
            <p id="unavailableMemberName" class="text-gray-700 mb-4"></p>
            <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="unavailableDate">Data indisponibilitÄƒÈ›ii (ZZ-LL-AAAA)</label>
            <input type="text" id="unavailableDateInput" placeholder="ex: 25-12-2024" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-6">
            <div class="flex space-x-3">
                <button onclick="confirmSetUnavailable()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" data-lang="save">SalveazÄƒ</button>
                <button onclick="clearUnavailable()" class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-600 transition" data-lang="clearUnavailable">È˜terge indisponibilitatea</button>
                <button onclick="closeModal('setUnavailableModal')" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" data-lang="cancel">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAg-8kByVcC4gh1FEuZJvnhs525nQShixA",
            authDomain: "diaspora-romana-15c53.firebaseapp.com",
            databaseURL: "https://diaspora-romana-15c53-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "diaspora-romana-15c53",
            storageBucket: "diaspora-romana-15c53.firebasestorage.app",
            messagingSenderId: "983580221213",
            appId: "1:983580221213:web:d9f4b82f8acb7ec47f8bf4",
            measurementId: "G-HHCTDB7CFS"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Language system
        const translations = {
            ro: {
                title: "Diaspora Romana Tournament",
                adminLogin: "Admin Login",
                logout: "Logout",
                totalMembers: "Membri Total",
                mainList: "ListÄƒ PrincipalÄƒ",
                reserveList: "ListÄƒ Rezerve",
                unavailableList: "Indisponibili",
                adminPanel: "Panou Administrare",
                generateList: "GenereazÄƒ Lista",
                unlockList: "DeblocheazÄƒ Lista",
                addMember: "AdaugÄƒ Membru",
                bulkUpload: "ÃncÄƒrcare Bulk",
                auditLog: "Audit Log",
                memberLists: "Liste Membri",
                history: "Istoric",
                players: "jucÄƒtori",
                mainListTitle: "ListÄƒ PrincipalÄƒ",
                reserveListTitle: "ListÄƒ Rezerve",
                unavailableListTitle: "Indisponibili",
                adminLoginTitle: "Autentificare Administrator",
                login: "Login",
                cancel: "AnuleazÄƒ",
                unlockTitle: "DeblocheazÄƒ Lista ZilnicÄƒ",
                unlockDesc: "IntroduceÈ›i parola pentru a debloca lista È™i a o regenera:",
                unlock: "DeblocheazÄƒ",
                addMemberTitle: "AdaugÄƒ Membru Nou",
                unavailableDate: "Data indisponibilitÄƒÈ›ii (ZZ-LL-AAAA)",
                add: "AdaugÄƒ",
                bulkUploadTitle: "ÃncÄƒrcare Bulk",
                bulkWarning: "âš ï¸ AtenÈ›ie: AceastÄƒ acÈ›iune va È™terge toÈ›i membrii existenÈ›i!",
                upload: "ÃncarcÄƒ",
                selectPlayers: "SelectaÈ›i 5 jucÄƒtori pentru Ã®nlocuire",
                selectedCount: "SelectaÈ›i: <span class=\"font-bold text-blue-600\">0</span>/5",
                continue: "ContinuÄƒ",
                confirmReplace: "Confirmare Ãnlocuire",
                playersToReplace: "JucÄƒtori care vor fi Ã®nlocuiÈ›i:",
                playersToEnter: "JucÄƒtori care vor intra Ã®n listÄƒ:",
                confirmReplaceBtn: "ConfirmÄƒ Ãnlocuirea",
                backToSelection: "Revino la SelecÈ›ie",
                cancelAll: "AnuleazÄƒ Tot",
                historyTitle: "Istoric Listelor Zilnice",
                close: "Ãnchide",
                auditLogTitle: "Audit Log",
                setUnavailableTitle: "Setare Indisponibilitate",
                save: "SalveazÄƒ",
                clearUnavailable: "È˜terge indisponibilitatea",
                backToAll: "Ãnapoi la toate listele",
                autoSelected: "SelecÈ›ie automatÄƒ:",
                autoSelectedDesc: "JucÄƒtorii indisponibili din lista principalÄƒ sunt preselecÈ›aÈ›i (roÈ™u). AceÈ™tia vor fi Ã®nlocuiÈ›i automat."
            },
            en: {
                title: "Diaspora Romana Tournament",
                adminLogin: "Admin Login",
                logout: "Logout",
                totalMembers: "Total Members",
                mainList: "Main List",
                reserveList: "Reserve List",
                unavailableList: "Unavailable",
                adminPanel: "Admin Panel",
                generateList: "Generate List",
                unlockList: "Unlock List",
                addMember: "Add Member",
                bulkUpload: "Bulk Upload",
                auditLog: "Audit Log",
                memberLists: "Member Lists",
                history: "History",
                players: "players",
                mainListTitle: "Main List",
                reserveListTitle: "Reserve List",
                unavailableListTitle: "Unavailable",
                adminLoginTitle: "Administrator Login",
                login: "Login",
                cancel: "Cancel",
                unlockTitle: "Unlock Daily List",
                unlockDesc: "Enter password to unlock and regenerate the list:",
                unlock: "Unlock",
                addMemberTitle: "Add New Member",
                unavailableDate: "Unavailable Date (DD-MM-YYYY)",
                add: "Add",
                bulkUploadTitle: "Bulk Upload",
                bulkWarning: "âš ï¸ Warning: This action will delete all existing members!",
                upload: "Upload",
                selectPlayers: "Select 5 players to replace",
                selectedCount: "Select: <span class=\"font-bold text-blue-600\">0</span>/5",
                continue: "Continue",
                confirmReplace: "Confirm Replacement",
                playersToReplace: "Players to be replaced:",
                playersToEnter: "Players who will enter the list:",
                confirmReplaceBtn: "Confirm Replacement",
                backToSelection: "Back to Selection",
                cancelAll: "Cancel All",
                historyTitle: "Daily List History",
                close: "Close",
                auditLogTitle: "Audit Log",
                setUnavailableTitle: "Set Unavailability",
                save: "Save",
                clearUnavailable: "Clear Unavailability",
                backToAll: "Back to all lists",
                autoSelected: "Auto selection:",
                autoSelectedDesc: "Unavailable players from main list are pre-selected (red). These will be automatically replaced."
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'ro';

        // Application State
        let appState = {
            isAdmin: localStorage.getItem('isAdmin') === 'true',
            members: [],
            dailyList: null,
            selectedForReplace: [],
            history: [],
            auditLog: [],
            currentUnavailableMember: null,
            currentView: 'threeColumns' // 'threeColumns' or 'singleList'
        };

        // Firebase functions
        function loadFromFirebase() {
            const dataRef = database.ref('tournamentData');
            
            dataRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    appState.members = data.members || [];
                    appState.dailyList = data.dailyList || null;
                    appState.history = data.history || [];
                    appState.auditLog = data.auditLog || [];
                } else {
                    initializeSampleData();
                }
                updateDashboard();
                if (appState.currentView === 'threeColumns') {
                    showAllLists();
                }
                checkDailyListStatus();
                checkUnavailableDates();
            });
        }

        function saveToFirebase() {
            const data = {
                members: appState.members,
                dailyList: appState.dailyList,
                history: appState.history,
                auditLog: appState.auditLog
            };
            database.ref('tournamentData').set(data);
        }

        function initializeSampleData() {
            const sampleNames = [
                'Andrei Popescu', 'Maria Ionescu', 'George Vasile', 'Elena Radu',
                'Mihai Stan', 'Ana Dumitru', 'Constantin Petre', 'Ioana Matei',
                'Alexandru Constantin', 'Roxana Gheorghe', 'Sorin Marin', 'Cristina Pop',
                'Dumitru Stoica', 'Gabriela Florea', 'Nicolae Grigore', 'Laura Mihai',
                'Marian Diaconu', 'Andreea Oprea', 'Stelian Toma', 'Simona Stanciu',
                'Valentin Ursu', 'Monica BÄƒlan', 'CÄƒtÄƒlin Dima', 'Adela Cristea',
                'Paul Grecu', 'Dana Ene', 'Bogdan Iancu', 'Camelia Radu',
                'Florin Munteanu', 'Raluca Paraschiv', 'Daniel Costea', 'Mirela Bucur',
                'Mihai GhiÈ›Äƒ', 'Anca BÄƒrbulescu', 'Ionel PÄƒun', 'Elena Dobre',
                'Adrian Chiriac', 'Sorina Neagu', 'Vasile Stoian', 'Carmen Preda'
            ];

            appState.members = sampleNames.map((name, index) => ({
                id: index + 1,
                name: name,
                status: index < 32 ? 'main' : 'reserve',
                unavailableDate: null,
                addedDate: new Date().toISOString()
            }));

            saveToFirebase();
        }

        // Initialize application
        function initApp() {
            loadFromFirebase();
            applyLanguage(currentLanguage);
            updateLoginState();
        }

        // Language functions
        function toggleLangDropdown() {
            const menu = document.getElementById('langDropdownMenu');
            menu.classList.toggle('hidden');
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            applyLanguage(lang);
            document.getElementById('langDropdownMenu').classList.add('hidden');
        }

        function applyLanguage(lang) {
            const elements = document.querySelectorAll('[data-lang]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            
            // Update current language display
            document.getElementById('currentLang').textContent = lang === 'ro' ? 'ğŸ‡·ğŸ‡´ RO' : 'ğŸ‡¬ğŸ‡§ EN';
        }

        // View functions
        function showSingleList(listType) {
            appState.currentView = 'singleList';
            document.getElementById('threeColumnView').classList.add('hidden');
            document.getElementById('singleListView').classList.add('active');
            
            const titles = {
                'all': currentLanguage === 'ro' ? 'ToÈ›i Membrii' : 'All Members',
                'main': currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ' : 'Main List',
                'reserve': currentLanguage === 'ro' ? 'ListÄƒ Rezerve' : 'Reserve List',
                'unavailable': currentLanguage === 'ro' ? 'Indisponibili' : 'Unavailable'
            };
            
            document.getElementById('singleListTitle').textContent = titles[listType];
            
            let members = [];
            switch(listType) {
                case 'main':
                    members = appState.members.filter(m => m.status === 'main');
                    break;
                case 'reserve':
                    members = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate);
                    break;
                case 'unavailable':
                    members = appState.members.filter(m => m.unavailableDate);
                    members.sort((a, b) => {
                        const dateA = new Date(a.unavailableDate.split('-').reverse().join('-'));
                        const dateB = new Date(b.unavailableDate.split('-').reverse().join('-'));
                        return dateA - dateB;
                    });
                    break;
                default:
                    members = appState.members;
            }
            
            const container = document.getElementById('singleListContent');
            container.innerHTML = members.map((member, index) => {
                const statusText = member.unavailableDate ? 
                    `${currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until'} ${member.unavailableDate}` :
                    member.status === 'main' ? 
                        (currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ' : 'Main List') : 
                        (currentLanguage === 'ro' ? 'ListÄƒ Rezerve' : 'Reserve List');
                
                const emoji = member.unavailableDate ? 'ğŸš«' : 
                             member.status === 'main' ? 'ğŸ†' : 'â³';
                
                return `
                    <div class="list-item flex items-center justify-between bg-gray-50 rounded-lg hover:bg-gray-100 transition border border-gray-200 ${member.unavailableDate ? 'unavailable-member' : ''}">
                        <div class="flex items-center space-x-3">
                            <span class="position-badge text-sm font-bold text-gray-500">#${index + 1}</span>
                            <span class="text-lg">${emoji}</span>
                            <div>
                                <p class="font-medium text-gray-900">${member.name}</p>
                                <p class="text-xs text-gray-600">${statusText}</p>
                            </div>
                        </div>
                        ${appState.isAdmin ? `
                            <div class="flex items-center space-x-2">
                                <button onclick="setUnavailable(${member.id})" class="px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs">
                                    ${member.unavailableDate ? (currentLanguage === 'ro' ? 'ModificÄƒ' : 'Modify') : (currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable')}
                                </button>
                                <button onclick="deleteMember(${member.id})" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs">
                                    ${currentLanguage === 'ro' ? 'È˜terge' : 'Delete'}
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function backToThreeColumns() {
            appState.currentView = 'threeColumns';
            document.getElementById('threeColumnView').classList.remove('hidden');
            document.getElementById('singleListView').classList.remove('active');
            showAllLists();
        }

        // Authentication
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('adminPassword').focus();
        }

        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === '@diaspora') {
                appState.isAdmin = true;
                localStorage.setItem('isAdmin', 'true');
                updateLoginState();
                closeModal('loginModal');
                showToast(currentLanguage === 'ro' ? 'Autentificare reuÈ™itÄƒ!' : 'Login successful!', 'success');
                addAuditLog('Login administrator');
            } else {
                showToast(currentLanguage === 'ro' ? 'ParolÄƒ incorectÄƒ!' : 'Incorrect password!', 'error');
            }
            document.getElementById('adminPassword').value = '';
        }

        function logout() {
            appState.isAdmin = false;
            localStorage.setItem('isAdmin', 'false');
            updateLoginState();
            showToast(currentLanguage === 'ro' ? 'AÈ›i fost delogat!' : 'You have been logged out!', 'info');
        }

        function updateLoginState() {
            if (appState.isAdmin) {
                document.getElementById('adminControls').classList.remove('hidden');
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('userInfo').textContent = 'ğŸ‘¤ Administrator';
            } else {
                document.getElementById('adminControls').classList.add('hidden');
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.add('hidden');
                document.getElementById('userInfo').textContent = '';
            }
        }

        // Dashboard functions
        function updateDashboard() {
            const total = appState.members.length;
            const main = appState.members.filter(m => m.status === 'main').length;
            const reserve = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate).length;
            const unavailable = appState.members.filter(m => m.unavailableDate).length;

            document.getElementById('totalMembers').textContent = total;
            document.getElementById('mainListCount').textContent = main;
            document.getElementById('reserveListCount').textContent = reserve;
            document.getElementById('unavailableCount').textContent = unavailable;
        }

        function showAllLists() {
            // Main list
            const mainMembers = appState.members.filter(m => m.status === 'main');
            const mainContainer = document.getElementById('mainListContent');
            
            mainContainer.innerHTML = mainMembers.map((member, index) => `
                <div class="list-item flex items-center justify-between bg-white rounded-lg hover:bg-gray-100 transition border border-gray-200 ${member.unavailableDate ? 'unavailable-member' : ''}">
                    <div class="flex items-center space-x-3">
                        <span class="position-badge text-sm font-bold text-gray-500">#${index + 1}</span>
                        <span class="text-lg">ğŸ†</span>
                        <div>
                            <p class="font-medium text-gray-900">${member.name}</p>
                            <p class="text-xs text-gray-600">${member.unavailableDate ? `${currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until'} ${member.unavailableDate}` : (currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ' : 'Main List')}</p>
                        </div>
                    </div>
                    ${appState.isAdmin ? `
                        <div class="flex items-center space-x-2">
                            <button onclick="setUnavailable(${member.id})" class="px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs">
                                ${member.unavailableDate ? (currentLanguage === 'ro' ? 'ModificÄƒ' : 'Modify') : (currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable')}
                            </button>
                            <button onclick="deleteMember(${member.id})" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs">
                                ${currentLanguage === 'ro' ? 'È˜terge' : 'Delete'}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');

            // Reserve list - sort by addedDate to maintain FIFO
            const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
            const reserveContainer = document.getElementById('reserveListContent');
            
            reserveContainer.innerHTML = reserveMembers.map((member, index) => `
                <div class="list-item flex items-center justify-between bg-white rounded-lg hover:bg-gray-100 transition border border-gray-200">
                    <div class="flex items-center space-x-3">
                        <span class="position-badge text-sm font-bold text-gray-500">#${index + 1}</span>
                        <span class="text-lg">â³</span>
                        <div>
                            <p class="font-medium text-gray-900">${member.name}</p>
                            <p class="text-xs text-gray-600">${currentLanguage === 'ro' ? 'ListÄƒ Rezerve' : 'Reserve List'}</p>
                        </div>
                    </div>
                    ${appState.isAdmin ? `
                        <div class="flex items-center space-x-2">
                            <button onclick="setUnavailable(${member.id})" class="px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs">
                                ${currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable'}
                            </button>
                            <button onclick="deleteMember(${member.id})" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs">
                                ${currentLanguage === 'ro' ? 'È˜terge' : 'Delete'}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');

            // Unavailable list
            const unavailableMembers = appState.members.filter(m => m.unavailableDate);
            unavailableMembers.sort((a, b) => {
                const dateA = new Date(a.unavailableDate.split('-').reverse().join('-'));
                const dateB = new Date(b.unavailableDate.split('-').reverse().join('-'));
                return dateA - dateB;
            });
            const unavailableContainer = document.getElementById('unavailableListContent');
            
            unavailableContainer.innerHTML = unavailableMembers.map((member, index) => `
                <div class="list-item flex items-center justify-between bg-white rounded-lg hover:bg-gray-100 transition border border-gray-200">
                    <div class="flex items-center space-x-3">
                        <span class="position-badge text-sm font-bold text-gray-500">#${index + 1}</span>
                        <span class="text-lg">ğŸš«</span>
                        <div>
                            <p class="font-medium text-gray-900">${member.name}</p>
                            <p class="text-xs text-gray-600">${currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until'} ${member.unavailableDate}</p>
                        </div>
                    </div>
                    ${appState.isAdmin ? `
                        <div class="flex items-center space-x-2">
                            <button onclick="setUnavailable(${member.id})" class="px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-xs">
                                ${currentLanguage === 'ro' ? 'ModificÄƒ' : 'Modify'}
                            </button>
                            <button onclick="deleteMember(${member.id})" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-xs">
                                ${currentLanguage === 'ro' ? 'È˜terge' : 'Delete'}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Unlock Daily List
        function showUnlockModal() {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }
            document.getElementById('unlockModal').classList.remove('hidden');
        }

        function unlockDailyList() {
            const password = document.getElementById('unlockPassword').value;
            if (password !== 'BriSo') {
                showToast(currentLanguage === 'ro' ? 'ParolÄƒ incorectÄƒ!' : 'Incorrect password!', 'error');
                return;
            }
            
            appState.dailyList = null;
            saveToFirebase();
            closeModal('unlockModal');
            showToast(currentLanguage === 'ro' ? 'Lista a fost deblocatÄƒ cu succes!' : 'List unlocked successfully!', 'success');
            addAuditLog(currentLanguage === 'ro' ? 'Deblocare listÄƒ zilnicÄƒ' : 'Unlock daily list');
            checkDailyListStatus();
            
            document.getElementById('unlockPassword').value = '';
        }

        // Daily List Generation
        function generateDailyList() {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }

            const today = new Date().toDateString();
            if (appState.dailyList && appState.dailyList.date === today) {
                showToast(currentLanguage === 'ro' ? 'Lista pentru aceastÄƒ zi a fost deja generatÄƒ!' : 'List for today has already been generated!', 'warning');
                return;
            }

            const currentMain = appState.members.filter(m => m.status === 'main');
            const container = document.getElementById('currentListForReplace');
            
            // Find unavailable members in main list
            const unavailableInMain = currentMain.filter(m => m.unavailableDate);
            const unavailableIds = unavailableInMain.map(m => m.id);
            
            container.innerHTML = currentMain.map(member => {
                const isUnavailable = member.unavailableDate;
                const isPreselected = unavailableIds.includes(member.id);
                
                return `
                    <label class="flex items-center space-x-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition ${isUnavailable ? 'unavailable-member' : ''} ${isPreselected ? 'preselected' : ''}">
                        <input type="checkbox" value="${member.id}" onchange="updateSelectedCount()" class="w-4 h-4 text-blue-600" ${isPreselected ? 'checked' : ''} ${isUnavailable ? 'disabled' : ''}>
                        <span>${member.name}</span>
                        ${isUnavailable ? `<span class="text-xs text-red-600 ml-2">(${currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable'})</span>` : ''}
                    </label>
                `;
            }).join('');

            // Update selected count with preselected unavailable members
            updateSelectedCount();

            document.getElementById('generateListModal').classList.remove('hidden');
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('#currentListForReplace input[type="checkbox"]:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = count;
            
            // Enable/disable continue button based on selection count
            const continueBtn = document.getElementById('continueBtn');
            if (count === 5) {
                continueBtn.disabled = false;
                continueBtn.classList.remove('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
            } else {
                continueBtn.disabled = true;
                continueBtn.classList.add('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
            }
        }

        function showConfirmationModal() {
            const checkboxes = document.querySelectorAll('#currentListForReplace input[type="checkbox"]:checked');
            
            if (checkboxes.length !== 5) {
                const message = currentLanguage === 'ro' ? 
                    `Trebuie sÄƒ selectaÈ›i exact 5 jucÄƒtori! AveÈ›i selectat ${checkboxes.length}.` :
                    `You must select exactly 5 players! You have selected ${checkboxes.length}.`;
                showToast(message, 'error');
                return;
            }

            const selectedIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
            const selectedMembers = appState.members.filter(m => selectedIds.includes(m.id));
            
            // Get first 5 from reserve (FIFO order)
            const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
            const toPromote = reserveMembers.slice(0, 5);
            
            // Display confirmation
            document.getElementById('playersToReplace').innerHTML = selectedMembers.map(m => `â€¢ ${m.name}${m.unavailableDate ? ` (${currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable'})` : ''}`).join('<br>');
            document.getElementById('playersToPromote').innerHTML = toPromote.length > 0 ? 
                toPromote.map(m => `â€¢ ${m.name}`).join('<br>') : (currentLanguage === 'ro' ? 'Nu existÄƒ suficienÈ›i jucÄƒtori Ã®n rezerve' : 'Not enough players in reserves');
            
            appState.selectedForReplace = selectedIds;
            
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        function backToSelection() {
            document.getElementById('confirmationModal').classList.add('hidden');
        }

        function confirmGenerateList() {
            const selectedMembers = appState.members.filter(m => appState.selectedForReplace.includes(m.id));
            
            // Move selected to reserve queue (end of the line - update addedDate)
            selectedMembers.forEach(member => {
                member.status = 'reserve';
                member.unavailableDate = null; // Clear unavailability when moving to reserve
                member.addedDate = new Date().toISOString(); // Set to now to put at end of queue
            });

            // Get first 5 from reserve (FIFO order)
            const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
            const toPromote = reserveMembers.slice(0, 5);
            
            // Promote first 5 from reserves
            toPromote.forEach(member => {
                member.status = 'main';
            });

            // Save daily list snapshot
            const today = new Date().toDateString();
            const mainList = appState.members.filter(m => m.status === 'main');
            
            appState.dailyList = {
                date: today,
                list: mainList.map(m => m.name),
                replaced: selectedMembers.map(m => m.name),
                promoted: toPromote.map(m => m.name),
                generatedAt: new Date().toISOString()
            };

            // Add to history
            appState.history.unshift({...appState.dailyList});
            if (appState.history.length > 30) appState.history.pop();

            saveToFirebase();
            closeModal('confirmationModal');
            closeModal('generateListModal');
            showToast(currentLanguage === 'ro' ? 'Lista zilnicÄƒ a fost generatÄƒ cu succes!' : 'Daily list generated successfully!', 'success');
            addAuditLog(currentLanguage === 'ro' ? 'Generare listÄƒ zilnicÄƒ' : 'Generate daily list');
            updateDashboard();
            if (appState.currentView === 'threeColumns') {
                showAllLists();
            }
            checkDailyListStatus();
            
            // Reset selected for replace
            appState.selectedForReplace = [];
        }

        function checkDailyListStatus() {
            const today = new Date().toDateString();
            const statusDiv = document.getElementById('statusMessages');
            const statusText = document.getElementById('statusText');
            
            if (appState.dailyList && appState.dailyList.date === today) {
                const time = new Date(appState.dailyList.generatedAt).toLocaleTimeString('ro-RO');
                const message = currentLanguage === 'ro' ? 
                    `Lista pentru data de azi a fost generatÄƒ la ora ${time}. Lista este blocatÄƒ pentru astÄƒzi.` :
                    `List for today was generated at ${time}. List is locked for today.`;
                statusText.textContent = message;
                statusDiv.classList.remove('hidden');
                
                // Show next 5 reserves
                const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                    .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
                const nextReserves = reserveMembers.slice(0, 5);
                if (nextReserves.length > 0) {
                    const nextNames = nextReserves.map(r => r.name).join(', ');
                    const nextMessage = currentLanguage === 'ro' ? 
                        ` UrmÄƒtorii 5 jucÄƒtori care vor intra din rezerve sunt: ${nextNames}` :
                        ` Next 5 players who will enter from reserves: ${nextNames}`;
                    statusText.textContent += nextMessage;
                }
            } else {
                statusDiv.classList.add('hidden');
            }
        }

        // Member Management
        function showAddMemberModal() {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }
            document.getElementById('addMemberModal').classList.remove('hidden');
        }

        function addMember() {
            const name = document.getElementById('newMemberName').value.trim();
            const unavailableDate = document.getElementById('newMemberUnavailableDate').value.trim();
            
            if (!name) {
                showToast(currentLanguage === 'ro' ? 'IntroduceÈ›i numele membrului!' : 'Enter member name!', 'error');
                return;
            }

            const newMember = {
                id: Date.now(),
                name: name,
                status: unavailableDate ? 'reserve' : 'reserve',
                unavailableDate: unavailableDate || null,
                addedDate: new Date().toISOString() // Always set to now for FIFO
            };

            appState.members.push(newMember);
            
            if (!unavailableDate) {
                // Check if main list needs filling
                const mainCount = appState.members.filter(m => m.status === 'main').length;
                if (mainCount < 32) {
                    const availableReserves = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate);
                    if (availableReserves.length > 0) {
                        // Get the oldest reserve to promote
                        const oldestReserve = availableReserves.sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate))[0];
                        oldestReserve.status = 'main';
                    }
                }
            }

            saveToFirebase();
            closeModal('addMemberModal');
            showToast(currentLanguage === 'ro' ? 'Membru a fost adÄƒugat cu succes!' : 'Member added successfully!', 'success');
            addAuditLog(`${currentLanguage === 'ro' ? 'AdÄƒugare membru:' : 'Add member:'} ${name}`);
            updateDashboard();
            if (appState.currentView === 'threeColumns') {
                showAllLists();
            }
            
            document.getElementById('newMemberName').value = '';
            document.getElementById('newMemberUnavailableDate').value = '';
        }

        function deleteMember(id) {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }

            const member = appState.members.find(m => m.id === id);
            if (!member) return;

            const confirmMessage = currentLanguage === 'ro' ? 
                `Sigur doriÈ›i sÄƒ È™tergeÈ›i membrul "${member.name}"?` :
                `Are you sure you want to delete member "${member.name}"?`;

            if (confirm(confirmMessage)) {
                appState.members = appState.members.filter(m => m.id !== id);
                
                // Fill main list if needed
                const mainCount = appState.members.filter(m => m.status === 'main').length;
                if (mainCount < 32) {
                    const reserves = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate);
                    const oldestReserves = reserves.sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
                    for (let i = 0; i < Math.min(32 - mainCount, oldestReserves.length); i++) {
                        oldestReserves[i].status = 'main';
                    }
                }

                saveToFirebase();
                showToast(currentLanguage === 'ro' ? 'Membru a fost È™ters cu succes!' : 'Member deleted successfully!', 'success');
                addAuditLog(`${currentLanguage === 'ro' ? 'È˜tergere membru:' : 'Delete member:'} ${member.name}`);
                updateDashboard();
                if (appState.currentView === 'threeColumns') {
                    showAllLists();
                }
            }
        }

        function setUnavailable(id) {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }

            const member = appState.members.find(m => m.id === id);
            if (!member) return;

            appState.currentUnavailableMember = member;
            document.getElementById('unavailableMemberName').textContent = `${currentLanguage === 'ro' ? 'Membru:' : 'Member:'} ${member.name}`;
            document.getElementById('unavailableDateInput').value = member.unavailableDate || '';
            document.getElementById('setUnavailableModal').classList.remove('hidden');
        }

        function confirmSetUnavailable() {
            const date = document.getElementById('unavailableDateInput').value.trim();
            
            if (date && !isValidDate(date)) {
                showToast(currentLanguage === 'ro' ? 'Format datÄƒ invalid! FolosiÈ›i ZZ-LL-AAAA' : 'Invalid date format! Use DD-MM-YYYY', 'error');
                return;
            }

            const member = appState.currentUnavailableMember;
            const oldDate = member.unavailableDate;
            
            member.unavailableDate = date || null;
            
            if (member.status === 'main' && date) {
                // Member stays in main list but is marked as unavailable
                // Will be automatically selected for replacement in next tournament generation
                member.addedDate = new Date().toISOString(); // Set for when moved to reserve
            } else if (!date && member.status === 'reserve') {
                // Check if can be promoted to main
                const mainCount = appState.members.filter(m => m.status === 'main').length;
                if (mainCount < 32) {
                    member.status = 'main';
                }
            }

            saveToFirebase();
            closeModal('setUnavailableModal');
            const message = currentLanguage === 'ro' ? 
                `Indisponibilitate ${date ? 'setatÄƒ' : 'È™tearsÄƒ'} pentru ${member.name}!` :
                `Unavailability ${date ? 'set' : 'cleared'} for ${member.name}!`;
            showToast(message, 'success');
            addAuditLog(`${currentLanguage === 'ro' ? 'Modificare indisponibilitate:' : 'Modify unavailability:'} ${member.name} - ${date || (currentLanguage === 'ro' ? 'disponibil' : 'available')}`);
            updateDashboard();
            if (appState.currentView === 'threeColumns') {
                showAllLists();
            }
        }

        function clearUnavailable() {
            document.getElementById('unavailableDateInput').value = '';
            confirmSetUnavailable();
        }

        function isValidDate(dateString) {
            const regex = /^(\d{2})-(\d{2})-(\d{4})$/;
            if (!regex.test(dateString)) return false;
            
            const parts = dateString.split('-');
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);
            
            const date = new Date(year, month - 1, day);
            return date.getFullYear() === year && date.getMonth() === month - 1 && date.getDate() === day;
        }

        function checkUnavailableDates() {
            const today = new Date();
            let hasChanges = false;

            appState.members.forEach(member => {
                if (member.unavailableDate) {
                    const parts = member.unavailableDate.split('-');
                    const unavailableDate = new Date(parts[2], parts[1] - 1, parts[0]);
                    if (unavailableDate <= today) {
                        member.unavailableDate = null;
                        member.status = 'reserve';
                        member.addedDate = new Date().toISOString(); // Put at end of reserve queue
                        hasChanges = true;
                    }
                }
            });

            if (hasChanges) {
                saveToFirebase();
                updateDashboard();
                if (appState.currentView === 'threeColumns') {
                    showAllLists();
                }
            }
        }

        // Bulk Upload
        function showBulkUploadModal() {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }
            document.getElementById('bulkUploadModal').classList.remove('hidden');
        }

        function processBulkUpload() {
            const password = document.getElementById('bulkPassword').value;
            if (password !== 'BriSo') {
                showToast(currentLanguage === 'ro' ? 'ParolÄƒ incorectÄƒ!' : 'Incorrect password!', 'error');
                return;
            }

            const data = document.getElementById('bulkData').value.trim();
            if (!data) {
                showToast(currentLanguage === 'ro' ? 'IntroduceÈ›i datele!' : 'Enter data!', 'error');
                return;
            }

            const confirmMessage = currentLanguage === 'ro' ? 
                'ATENÈšIE: ToÈ›i membrii existenÈ›i vor fi È™terÈ™i! ContinuaÈ›i?' :
                'WARNING: All existing members will be deleted! Continue?';

            if (!confirm(confirmMessage)) {
                return;
            }

            const names = data.split('\n').map(n => n.trim()).filter(n => n);
            
            // Clear all existing members
            appState.members = [];
            
            // Add new members
            names.forEach((name, index) => {
                const newMember = {
                    id: Date.now() + index,
                    name: name,
                    status: index < 32 ? 'main' : 'reserve',
                    unavailableDate: null,
                    addedDate: new Date().toISOString() // Set added date for FIFO
                };

                appState.members.push(newMember);
            });

            saveToFirebase();
            closeModal('bulkUploadModal');
            const message = currentLanguage === 'ro' ? 
                `${names.length} membri au fost Ã®ncÄƒrcaÈ›i cu succes! Lista a fost reiniÈ›ializatÄƒ.` :
                `${names.length} members uploaded successfully! List has been reset.`;
            showToast(message, 'success');
            addAuditLog(`${currentLanguage === 'ro' ? 'ÃncÄƒrcare bulk:' : 'Bulk upload:'} ${names.length} ${currentLanguage === 'ro' ? 'membri (listÄƒ reiniÈ›ializatÄƒ)' : 'members (list reset)'}`);
            updateDashboard();
            if (appState.currentView === 'threeColumns') {
                showAllLists();
            }
            
            document.getElementById('bulkPassword').value = '';
            document.getElementById('bulkData').value = '';
        }

        // History
        function showHistory() {
            const container = document.getElementById('historyContent');
            
            if (appState.history.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center py-8">${currentLanguage === 'ro' ? 'Nu existÄƒ date Ã®n istoric.' : 'No data in history.'}</p>`;
            } else {
                container.innerHTML = appState.history.map((item, index) => `
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-gray-900">
                                ${new Date(item.date).toLocaleDateString('ro-RO')}
                            </h4>
                            <span class="text-sm text-gray-600">
                                ${new Date(item.generatedAt).toLocaleTimeString('ro-RO')}
                            </span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-1">${currentLanguage === 'ro' ? 'Lista PrincipalÄƒ:' : 'Main List:'}</p>
                                <p class="text-sm text-gray-600">${item.list.join(', ')}</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-1">${currentLanguage === 'ro' ? 'ÃnlocuiÈ›i:' : 'Replaced:'}</p>
                                <p class="text-sm text-gray-600">${item.replaced.join(', ')}</p>
                            </div>
                            ${item.promoted ? `
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-1">${currentLanguage === 'ro' ? 'PromovaÈ›i:' : 'Promoted:'}</p>
                                <p class="text-sm text-gray-600">${item.promoted.join(', ')}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('historyModal').classList.remove('hidden');
        }

        // Audit Log
        function showAuditLog() {
            if (!appState.isAdmin) {
                showToast(currentLanguage === 'ro' ? 'Acces interzis!' : 'Access denied!', 'error');
                return;
            }

            const container = document.getElementById('auditLogContent');
            
            if (appState.auditLog.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center py-8">${currentLanguage === 'ro' ? 'Nu existÄƒ Ã®nregistrÄƒri Ã®n audit log.' : 'No records in audit log.'}</p>`;
            } else {
                container.innerHTML = appState.auditLog.map(log => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900">${log.action}</p>
                            <p class="text-sm text-gray-600">${new Date(log.timestamp).toLocaleString('ro-RO')}</p>
                        </div>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                            ${log.admin}
                        </span>
                    </div>
                `).join('');
            }
            
            document.getElementById('auditLogModal').classList.remove('hidden');
        }

        function addAuditLog(action) {
            appState.auditLog.unshift({
                action: action,
                admin: 'Administrator',
                timestamp: new Date().toISOString()
            });
            
            if (appState.auditLog.length > 100) {
                appState.auditLog.pop();
            }
            
            saveToFirebase();
        }

        // Export Functions
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('Diaspora Romana Tournament', 20, 20);
            
            doc.setFontSize(14);
            doc.text(`${currentLanguage === 'ro' ? 'Data:' : 'Date:'} ${new Date().toLocaleDateString('ro-RO')}`, 20, 35);
            
            let y = 50;
            
            // Main list
            doc.setFontSize(12);
            doc.text(currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ:' : 'Main List:', 20, y);
            y += 10;
            
            const mainMembers = appState.members.filter(m => m.status === 'main');
            mainMembers.forEach((member, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const unavailableText = member.unavailableDate ? ` (${currentLanguage === 'ro' ? 'Indisponibil' : 'Unavailable'})` : '';
                doc.text(`${index + 1}. ${member.name}${unavailableText}`, 30, y);
                y += 8;
            });
            
            // Reserve list
            y += 10;
            doc.text(currentLanguage === 'ro' ? 'ListÄƒ Rezerve:' : 'Reserve List:', 20, y);
            y += 10;
            
            const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate));
            reserveMembers.forEach((member, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                doc.text(`${index + 1}. ${member.name}`, 30, y);
                y += 8;
            });
            
            // Unavailable list
            y += 10;
            doc.text(currentLanguage === 'ro' ? 'Indisponibili:' : 'Unavailable:', 20, y);
            y += 10;
            
            const unavailableMembers = appState.members.filter(m => m.unavailableDate);
            unavailableMembers.sort((a, b) => {
                const dateA = new Date(a.unavailableDate.split('-').reverse().join('-'));
                const dateB = new Date(b.unavailableDate.split('-').reverse().join('-'));
                return dateA - dateB;
            });
            
            unavailableMembers.forEach((member, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const unavailableText = currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until';
                doc.text(`${index + 1}. ${member.name} - ${unavailableText} ${member.unavailableDate}`, 30, y);
                y += 8;
            });
            
            doc.save(`diaspora-tournament-${Date.now()}.pdf`);
            showToast(currentLanguage === 'ro' ? 'PDF exportat cu succes!' : 'PDF exported successfully!', 'success');
        }

        function exportToExcel() {
            const mainMembers = appState.members.filter(m => m.status === 'main').map((m, i) => ({
                'PoziÈ›ie': i + 1,
                'Nume': m.name,
                'Status': m.unavailableDate ? `${currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until'} ${m.unavailableDate}` : (currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ' : 'Main List')
            }));
            
            const reserveMembers = appState.members.filter(m => m.status === 'reserve' && !m.unavailableDate)
                .sort((a, b) => new Date(a.addedDate) - new Date(b.addedDate))
                .map((m, i) => ({
                    'PoziÈ›ie': i + 1,
                    'Nume': m.name,
                    'Status': currentLanguage === 'ro' ? 'ListÄƒ Rezerve' : 'Reserve List'
                }));
            
            const unavailableMembers = appState.members.filter(m => m.unavailableDate).sort((a, b) => {
                const dateA = new Date(a.unavailableDate.split('-').reverse().join('-'));
                const dateB = new Date(b.unavailableDate.split('-').reverse().join('-'));
                return dateA - dateB;
            }).map((m, i) => ({
                'PoziÈ›ie': i + 1,
                'Nume': m.name,
                'Status': `${currentLanguage === 'ro' ? 'Indisponibil pÃ¢nÄƒ la' : 'Unavailable until'} ${m.unavailableDate}`
            }));
            
            const wb = XLSX.utils.book_new();
            
            // Create worksheets for each list
            const wsMain = XLSX.utils.json_to_sheet(mainMembers);
            const wsReserve = XLSX.utils.json_to_sheet(reserveMembers);
            const wsUnavailable = XLSX.utils.json_to_sheet(unavailableMembers);
            
            XLSX.utils.book_append_sheet(wb, wsMain, currentLanguage === 'ro' ? 'ListÄƒ PrincipalÄƒ' : 'Main List');
            XLSX.utils.book_append_sheet(wb, wsReserve, currentLanguage === 'ro' ? 'ListÄƒ Rezerve' : 'Reserve List');
            XLSX.utils.book_append_sheet(wb, wsUnavailable, currentLanguage === 'ro' ? 'Indisponibili' : 'Unavailable');
            
            XLSX.writeFile(wb, `diaspora-tournament-${Date.now()}.xlsx`);
            showToast(currentLanguage === 'ro' ? 'Excel exportat cu succes!' : 'Excel exported successfully!', 'success');
        }

        // UI Utilities
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            document.getElementById('darkModeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkMode', isDark);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `toast ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Event Listeners
        document.getElementById('adminPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        document.getElementById('newMemberName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addMember();
        });

        document.getElementById('unlockPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') unlockDailyList();
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.lang-dropdown')) {
                document.getElementById('langDropdownMenu').classList.add('hidden');
            }
        });

        // Initialize dark mode
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark');
            document.getElementById('darkModeIcon').textContent = 'â˜€ï¸';
        }

        // Initialize app on load
        window.addEventListener('load', initApp);

        // Check unavailable dates every minute
        setInterval(checkUnavailableDates, 60000);
    </script>
</body>
</html>
